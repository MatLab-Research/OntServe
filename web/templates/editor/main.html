{% extends "base.html" %}

{% block title %}{{ page_title }} - OntServe{% endblock %}

{% block extra_css %}
<style>
    .ontology-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .ontology-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .entity-stats {
        font-size: 0.9em;
        color: #666;
    }

    .toolbar {
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 1rem 0;
    }

    .search-box {
        max-width: 400px;
    }
</style>
{% endblock %}

{% block content %}
<div class="toolbar">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="h3 mb-0">
                    <i class="bi bi-pencil-square me-2"></i>
                    Ontology Editor
                </h1>
                <small class="text-muted">Create, edit, and visualize ontologies with semantic search</small>
            </div>
            <div class="col-md-6">
                <div class="d-flex justify-content-end gap-2">
                    <button class="btn btn-success" onclick="createNewOntology()">
                        <i class="bi bi-plus-circle me-1"></i>New Ontology
                    </button>
                    <button class="btn btn-outline-primary" onclick="refreshOntologies()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-funnel me-2"></i>Filter & Search
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <input type="text" class="form-control search-box" id="searchOntologies"
                            placeholder="Search ontologies...">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Entity Type</label>
                        <select class="form-select" id="filterEntityType">
                            <option value="">All Types</option>
                            <option value="class">Classes</option>
                            <option value="property">Properties</option>
                            <option value="individual">Individuals</option>
                            <option value="role">Roles</option>
                        </select>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="filterFoundationOnly">
                        <label class="form-check-label" for="filterFoundationOnly">
                            BFO-aligned only
                        </label>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-bar-chart me-2"></i>Statistics
                    </h6>
                </div>
                <div class="card-body">
                    <div id="ontologyStats">
                        <div class="d-flex justify-content-between">
                            <small>Total Ontologies:</small>
                            <strong id="totalOntologies">{{ ontologies|length }}</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small>Total Entities:</small>
                            <strong id="totalEntities">-</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small>Foundation Ontologies:</small>
                            <strong id="foundationCount">-</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div id="ontologyGrid" class="row">
                {% for ontology in ontologies %}
                <div class="col-md-6 col-lg-4 mb-4 ontology-item" data-name="{{ ontology.name|lower }}"
                    data-id="{{ ontology.ontology_id or ontology.id }}">
                    <div class="card ontology-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="card-title mb-0">{{ ontology.name }}</h6>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
                                    data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="{{ url_for('edit_ontology', ontology_name=ontology.name) }}">
                                            <i class="bi bi-pencil me-2"></i>Edit Content
                                        </a></li>
                                    <li><a class="dropdown-item"
                                            href="{{ url_for('ontology_editor.visualize_ontology', ontology_name=ontology.name) }}">
                                            <i class="bi bi-diagram-3 me-2"></i>Visualize
                                        </a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="#"
                                            onclick="extractEntities('{{ ontology.ontology_id or ontology.id }}')">
                                            <i class="bi bi-arrow-clockwise me-2"></i>Extract Entities
                                        </a></li>
                                    <li><a class="dropdown-item text-danger" href="#"
                                            onclick="deleteOntology('{{ ontology.ontology_id or ontology.id }}')">
                                            <i class="bi bi-trash me-2"></i>Delete
                                        </a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            {% if ontology.description %}
                            <p class="card-text small text-muted">{{ ontology.description[:100] }}{% if
                                ontology.description|length > 100 %}...{% endif %}</p>
                            {% endif %}

                            <div class="entity-stats">
                                <div class="row text-center">
                                    <div class="col">
                                        <strong>{{ ontology.class_count or 0 }}</strong><br>
                                        <small>Classes</small>
                                    </div>
                                    <div class="col">
                                        <strong>{{ ontology.property_count or 0 }}</strong><br>
                                        <small>Properties</small>
                                    </div>
                                    <div class="col">
                                        <strong>{{ ontology.triple_count or 0 }}</strong><br>
                                        <small>Triples</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="{{ url_for('edit_ontology', ontology_name=ontology.name) }}" class="btn btn-primary">
                                        <i class="bi bi-pencil me-1"></i>Edit
                                    </a>
                                    <a href="{{ url_for('ontology_detail', ontology_name=ontology.name) }}"
                                        class="btn btn-outline-primary">
                                        <i class="bi bi-info-circle me-1"></i>Details
                                    </a>
                                    <a href="{{ url_for('ontology_editor.visualize_ontology', ontology_name=ontology.name) }}"
                                        class="btn btn-success">
                                        <i class="bi bi-diagram-3 me-1"></i>Visualize
                                    </a>
                                </div>
                                <small class="text-muted">
                                    {% if ontology.version_count %}
                                        {{ ontology.version_count }} version{{ 's' if ontology.version_count != 1 else '' }}
                                    {% else %}
                                        No versions
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
function createNewOntology() {
    window.location.href = '{{ url_for("import_ontology") }}';
}

function refreshOntologies() {
    window.location.reload();
}

function extractEntities(ontologyId) {
    console.log('Extract entities for:', ontologyId);
    // Implement extract entities functionality
}

function deleteOntology(ontologyId) {
    if (confirm('Are you sure you want to delete this ontology?')) {
        console.log('Delete ontology:', ontologyId);
        // Implement delete functionality
    }
}

// Search functionality
document.getElementById('searchOntologies').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const ontologyItems = document.querySelectorAll('.ontology-item');
    
    ontologyItems.forEach(item => {
        const name = item.dataset.name;
        if (name.includes(searchTerm)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
});
</script>
{% endblock %}