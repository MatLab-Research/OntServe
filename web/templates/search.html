{% extends "base.html" %}

{% block title %}Search - OntServe{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="bi bi-search"></i> Search Results
        </h1>
        
        <!-- Search form -->
        <form method="get" action="{{ url_for('search') }}" class="mb-4">
            <div class="row">
                <div class="col-md-8">
                    <input type="text" class="form-control" name="q" 
                           placeholder="Search ontologies and entities..." 
                           value="{{ query }}" required>
                </div>
                <div class="col-md-2">
                    <select class="form-select" name="type">
                        <option value="all" {% if search_type == 'all' %}selected{% endif %}>All</option>
                        <option value="ontologies" {% if search_type == 'ontologies' %}selected{% endif %}>Ontologies</option>
                        <option value="entities" {% if search_type == 'entities' %}selected{% endif %}>Entities</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> Search
                    </button>
                </div>
            </div>
        </form>
        
        {% if query %}
        <!-- Search results -->
        <div class="alert alert-info">
            Found {{ results.ontologies|length + results.entities|length }} results for "{{ query }}"
        </div>
        
        <!-- Ontology results -->
        {% if results.ontologies %}
        <h3>Ontologies ({{ results.ontologies|length }})</h3>
        <div class="list-group mb-4">
            {% for ontology in results.ontologies %}
            <a href="{{ url_for('ontology_detail', ontology_id=ontology.ontology_id) }}" 
               class="list-group-item list-group-item-action">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">{{ ontology.name }}</h5>
                    <small><code>{{ ontology.ontology_id }}</code></small>
                </div>
                {% if ontology.description %}
                <p class="mb-1">{{ ontology.description[:200] }}{% if ontology.description|length > 200 %}...{% endif %}</p>
                {% endif %}
                <small>{{ ontology.triple_count or 0 }} triples | {{ ontology.class_count or 0 }} classes | {{ ontology.property_count or 0 }} properties</small>
            </a>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Entity results -->
        {% if results.entities %}
        <h3>Entities ({{ results.entities|length }})</h3>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Label</th>
                        <th>Type</th>
                        <th>Ontology</th>
                        <th>URI</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entity in results.entities %}
                    <tr onclick="window.location='{{ url_for('ontology_detail', ontology_id=entity.ontology.ontology_id) }}'" style="cursor: pointer;">
                        <td>
                            <strong>{{ entity.label or entity.uri|extract_name }}</strong>
                            {% if entity.comment %}
                            <br><small class="text-muted">{{ entity.comment[:100] }}...</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-{{ 'success' if entity.entity_type == 'class' else 'info' if entity.entity_type == 'property' else 'warning' }}">
                                {{ entity.entity_type }}
                            </span>
                        </td>
                        <td>{{ entity.ontology.name }}</td>
                        <td><code class="small">{{ entity.uri[:50] }}...</code></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        
        {% if not results.ontologies and not results.entities %}
        <div class="alert alert-warning">
            No results found for "{{ query }}". Try a different search term.
        </div>
        {% endif %}
        
        {% else %}
        <!-- No search performed yet -->
        <div class="alert alert-info">
            <h4 class="alert-heading">Search Tips</h4>
            <ul>
                <li>Search for ontology names, IDs, or descriptions</li>
                <li>Find entities by their labels, comments, or URIs</li>
                <li>Use the filter to search only ontologies or entities</li>
            </ul>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
